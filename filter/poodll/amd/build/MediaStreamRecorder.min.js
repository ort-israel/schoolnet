function MediaStreamRecorder(a){if(!a)throw"MediaStream is mandatory.";this.start=function(c){var d;"undefined"!=typeof MediaRecorder?d=MediaRecorderWrapper:(IsChrome||IsOpera||IsEdge)&&(-1!==this.mimeType.indexOf("video")?d=WhammyRecorder:-1!==this.mimeType.indexOf("audio")&&(d=StereoAudioRecorder)),"image/gif"===this.mimeType&&(d=GifRecorder),"audio/wav"===this.mimeType&&(d=StereoAudioRecorder),this.recorderType&&(d=this.recorderType),b=new d(a),b.blobs=[];var e=this;b.ondataavailable=function(a){b.blobs.push(a),e.ondataavailable(a)},b.onstop=this.onstop,b.onStartedDrawingNonBlankFrames=this.onStartedDrawingNonBlankFrames,b=mergeProps(b,this),b.start(c)},this.onStartedDrawingNonBlankFrames=function(){},this.clearOldRecordedFrames=function(){b&&b.clearOldRecordedFrames()},this.stop=function(){b&&b.stop()},this.ondataavailable=function(a){console.log("ondataavailable..",a)},this.onstop=function(a){console.warn("stopped..",a)},this.save=function(a,c){if(!a){if(!b)return;return void ConcatenateBlobs(b.blobs,b.blobs[0].type,function(a){invokeSaveAsDialog(a)})}invokeSaveAsDialog(a,c)},this.pause=function(){b&&(b.pause(),console.log("Paused recording.",this.mimeType||b.mimeType))},this.resume=function(){b&&(b.resume(),console.log("Resumed recording.",this.mimeType||b.mimeType))},this.recorderType=null,this.mimeType="video/webm",this.disableLogs=!1;var b}function MultiStreamRecorder(a){if(!a)throw"MediaStream is mandatory.";var b=this,c=isMediaRecorderCompatible();this.stream=a,this.start=function(h){function i(a){g++,b.ondataavailable(a)}d=new MediaStreamRecorder(a),e=new MediaStreamRecorder(a),d.mimeType="audio/ogg",e.mimeType="video/webm";for(var j in this)"function"!=typeof this[j]&&(d[j]=e[j]=this[j]);d.ondataavailable=function(a){f[g]||(f[g]={}),f[g].audio=a,f[g].video&&!f[g].onDataAvailableEventFired&&(f[g].onDataAvailableEventFired=!0,i(f[g]))},e.ondataavailable=function(a){return c?b.ondataavailable({video:a,audio:a}):(f[g]||(f[g]={}),f[g].video=a,void(f[g].audio&&!f[g].onDataAvailableEventFired&&(f[g].onDataAvailableEventFired=!0,i(f[g]))))},e.onstop=d.onstop=function(a){b.onstop(a)},c?e.start(h):(e.onStartedDrawingNonBlankFrames=function(){e.clearOldRecordedFrames(),d.start(h)},e.start(h))},this.stop=function(){d&&d.stop(),e&&e.stop()},this.ondataavailable=function(a){console.log("ondataavailable..",a)},this.onstop=function(a){console.warn("stopped..",a)},this.pause=function(){d&&d.pause(),e&&e.pause()},this.resume=function(){d&&d.resume(),e&&e.resume()};var d,e,f={},g=0}function mergeProps(a,b){for(var c in b)"function"!=typeof b[c]&&(a[c]=b[c]);return a}function dropFirstFrame(a){return a.shift(),a}function invokeSaveAsDialog(a,b){if(!a)throw"Blob object is required.";if(!a.type)try{a.type="video/webm"}catch(c){}var d=(a.type||"video/webm").split("/")[1];if(b&&-1!==b.indexOf(".")){var e=b.split(".");b=e[0],d=e[1]}var f=(b||Math.round(9999999999*Math.random())+888888888)+"."+d;if("undefined"!=typeof navigator.msSaveOrOpenBlob)return navigator.msSaveOrOpenBlob(a,f);if("undefined"!=typeof navigator.msSaveBlob)return navigator.msSaveBlob(a,f);var g=document.createElement("a");g.href=URL.createObjectURL(a),g.target="_blank",g.download=f,navigator.mozGetUserMedia&&(g.onclick=function(){(document.body||document.documentElement).removeChild(g)},(document.body||document.documentElement).appendChild(g));var h=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});g.dispatchEvent(h),navigator.mozGetUserMedia||URL.revokeObjectURL(g.href)}function bytesToSize(a){var b=1e3,c=["Bytes","KB","MB","GB","TB"];if(0===a)return"0 Bytes";var d=parseInt(Math.floor(Math.log(a)/Math.log(b)),10);return(a/Math.pow(b,d)).toPrecision(3)+" "+c[d]}function isMediaRecorderCompatible(){var a=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,b=!!window.chrome&&!a,c="undefined"!=typeof window.InstallTrigger;if(c)return!0;if(!b)return!1;var d,e,f=(navigator.appVersion,navigator.userAgent),g=""+parseFloat(navigator.appVersion),h=parseInt(navigator.appVersion,10);return b&&(d=f.indexOf("Chrome"),g=f.substring(d+7)),-1!==(e=g.indexOf(";"))&&(g=g.substring(0,e)),-1!==(e=g.indexOf(" "))&&(g=g.substring(0,e)),h=parseInt(""+g,10),isNaN(h)&&(g=""+parseFloat(navigator.appVersion),h=parseInt(navigator.appVersion,10)),h>=49}function MediaRecorderWrapper(a){function b(){if("active"in a){if(!a.active)return!1}else if("ended"in a&&a.ended)return!1;return!0}var c=this;this.start=function(b,e){if(c.mimeType||(c.mimeType="video/webm"),-1!==c.mimeType.indexOf("audio")&&a.getVideoTracks().length&&a.getAudioTracks().length){var f;navigator.mozGetUserMedia?(f=new MediaStream,f.addTrack(a.getAudioTracks()[0])):f=new MediaStream(a.getAudioTracks()),a=f}-1!==c.mimeType.indexOf("audio")&&(c.mimeType=IsChrome?"audio/webm":"audio/ogg"),c.blob=null,c.dontFireOnDataAvailableEvent=!1;var g={mimeType:c.mimeType};c.disableLogs||e||console.log("Passing following params over MediaRecorder API.",g),d&&(d=null),IsChrome&&!isMediaRecorderCompatible()&&(g="video/vp8"),d=new MediaRecorder(a,g),"canRecordMimeType"in d&&d.canRecordMimeType(c.mimeType)===!1&&(c.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",c.mimeType)),d.ignoreMutedMedia=c.ignoreMutedMedia||!1,d.ondataavailable=function(a){if(!c.dontFireOnDataAvailableEvent&&a.data&&a.data.size&&!(a.data.size<100)&&!c.blob){var e=c.getNativeBlob?a.data:new Blob([a.data],{type:c.mimeType||"video/webm"});c.ondataavailable(e),c.dontFireOnDataAvailableEvent=!0,d.stop(),d=null,c.start(b,"__disableLogs")}},d.onerror=function(a){c.disableLogs||("InvalidState"===a.name?console.error("The MediaRecorder is not in a state in which the proposed operation is allowed to be executed."):"OutOfMemory"===a.name?console.error("The UA has exhaused the available memory. User agents SHOULD provide as much additional information as possible in the message attribute."):"IllegalStreamModification"===a.name?console.error("A modification to the stream has occurred that makes it impossible to continue recording. An example would be the addition of a Track while recording is occurring. User agents SHOULD provide as much additional information as possible in the message attribute."):"OtherRecordingError"===a.name?console.error("Used for an fatal error other than those listed above. User agents SHOULD provide as much additional information as possible in the message attribute."):"GenericError"===a.name?console.error("The UA cannot provide the codec or recording option that has been requested.",a):console.error("MediaRecorder Error",a)),"inactive"!==d.state&&"stopped"!==d.state&&d.stop()},d.start(36e5),setTimeout(function(){d&&"recording"===d.state&&d.requestData()},b)},this.stop=function(a){d&&"recording"===d.state&&(d.requestData(),setTimeout(function(){c.dontFireOnDataAvailableEvent=!0,"recording"===d.state&&d.stop(),d=null},2e3))},this.pause=function(){d&&"recording"===d.state&&d.pause()},this.ondataavailable=function(a){console.log("recorded-blob",a)},this.resume=function(){if(this.dontFireOnDataAvailableEvent){this.dontFireOnDataAvailableEvent=!1;var a=c.disableLogs;return c.disableLogs=!0,this.record(),void(c.disableLogs=a)}d&&"paused"===d.state&&d.resume()},this.clearRecordedData=function(){d&&(this.pause(),this.dontFireOnDataAvailableEvent=!0,this.stop())};var d;!function e(){return d?b()===!1?void c.stop():void setTimeout(e,1e3):void 0}()}function StereoAudioRecorder(a){this.start=function(d){d=d||1e3,b=new StereoAudioRecorderHelper(a,this),b.record(),c=setInterval(function(){b.requestData()},d)},this.stop=function(){b&&(b.stop(),clearTimeout(c))},this.pause=function(){b&&b.pause()},this.resume=function(){b&&b.resume()},this.ondataavailable=function(){};var b,c}function StereoAudioRecorderHelper(a,b){function c(a,b){for(var c=a.length+b.length,d=new Float32Array(c),e=0,f=0;c>f;)d[f++]=a[e],d[f++]=b[e],e++;return d}function d(a,b){for(var c=new Float32Array(b),d=0,e=a.length,f=0;e>f;f++){var g=a[f];c.set(g,d),d+=g.length}return c}function e(a,b,c){for(var d=c.length,e=0;d>e;e++)a.setUint8(b+e,c.charCodeAt(e))}var f=44100;ObjectStore.AudioContextConstructor||(ObjectStore.AudioContextConstructor=new ObjectStore.AudioContext),f=ObjectStore.AudioContextConstructor.sampleRate;var g,h,i,j,k=[],l=[],m=!1,n=0,o=b.sampleRate||f,p=b.audioChannels||2;this.record=function(){m=!0,k.length=l.length=0,n=0},this.requestData=function(){if(!s){if(0===n)return void(r=!1);r=!0;var a=k.slice(0),f=(l.slice(0),n);k.length=l.length=[],n=0,r=!1;var g=d(a,f),h=d(a,f);if(2===p)var i=c(g,h);else var i=g;var j=new ArrayBuffer(44+2*i.length),m=new DataView(j);e(m,0,"RIFF"),m.setUint32(4,44+2*i.length,!0),e(m,8,"WAVE"),e(m,12,"fmt "),m.setUint32(16,16,!0),m.setUint16(20,1,!0),m.setUint16(22,p,!0),m.setUint32(24,o,!0),m.setUint32(28,4*o,!0),m.setUint16(32,2*p,!0),m.setUint16(34,16,!0),e(m,36,"data"),m.setUint32(40,2*i.length,!0);for(var q=i.length,t=44,u=1,v=0;q>v;v++)m.setInt16(t,i[v]*(32767*u),!0),t+=2;var w=new Blob([m],{type:"audio/wav"});console.debug("audio recorded blob size:",bytesToSize(w.size)),b.ondataavailable(w)}},this.stop=function(){m=!1,this.requestData(),i.disconnect()};var j=ObjectStore.AudioContextConstructor;ObjectStore.VolumeGainNode=j.createGain();var h=ObjectStore.VolumeGainNode;ObjectStore.AudioInput=j.createMediaStreamSource(a);var i=ObjectStore.AudioInput;i.connect(h);var q=b.bufferSize||2048;if(0===b.bufferSize&&(q=0),j.createJavaScriptNode)g=j.createJavaScriptNode(q,p,p);else{if(!j.createScriptProcessor)throw"WebAudio API has no support on this browser.";g=j.createScriptProcessor(q,p,p)}q=g.bufferSize,console.debug("using audio buffer-size:",q);var r=!1;window.scriptprocessornode=g,1===p&&console.debug("All right-channels are skipped.");var s=!1;this.pause=function(){s=!0},this.resume=function(){s=!1},g.onaudioprocess=function(a){if(m&&!r&&!s){var b=a.inputBuffer.getChannelData(0);if(k.push(new Float32Array(b)),2===p){var c=a.inputBuffer.getChannelData(1);l.push(new Float32Array(c))}n+=q}},h.connect(g),g.connect(j.destination)}function WhammyRecorder(a){this.start=function(d){d=d||1e3,b=new WhammyRecorderHelper(a,this);for(var e in this)"function"!=typeof this[e]&&(b[e]=this[e]);b.record(),c=setInterval(function(){b.requestData()},d)},this.stop=function(){b&&(b.stop(),clearTimeout(c))},this.clearOldRecordedFrames=function(){b&&b.clearOldRecordedFrames()},this.pause=function(){b&&b.pause()},this.resume=function(){b&&b.resume()},this.ondataavailable=function(){};var b,c}function WhammyRecorderHelper(a,b){function c(){if(o)return j=(new Date).getTime(),void setTimeout(c,500);if(!h){if(f)return setTimeout(c,100);var a=(new Date).getTime()-j;if(!a)return c();j=(new Date).getTime(),!n.isHTMLObject&&i.paused&&i.play(),m.drawImage(i,0,0,l.width,l.height),h||k.frames.push({duration:a,image:l.toDataURL("image/webp")}),g||d(k.frames[k.frames.length-1])||(g=!0,b.onStartedDrawingNonBlankFrames()),setTimeout(c,10)}}function d(a,b,c){var d=document.createElement("canvas");d.width=l.width,d.height=l.height;var e,f,g,h=d.getContext("2d"),i={r:0,g:0,b:0},j=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),k=b&&b>=0&&1>=b?b:0,m=c&&c>=0&&1>=c?c:0,n=new Image;n.src=a.image,h.drawImage(n,0,0,l.width,l.height);var o=h.getImageData(0,0,l.width,l.height);e=0,f=o.data.length,g=o.data.length/4;for(var p=0;f>p;p+=4){var q={r:o.data[p],g:o.data[p+1],b:o.data[p+2]},r=Math.sqrt(Math.pow(q.r-i.r,2)+Math.pow(q.g-i.g,2)+Math.pow(q.b-i.b,2));j*k>=r&&e++}return g*m>=g-e?!1:!0}function e(a,b,c,d){var e=document.createElement("canvas");e.width=l.width,e.height=l.height;for(var f=e.getContext("2d"),g=[],h=-1===b,i=b&&b>0&&b<=a.length?b:a.length,j={r:0,g:0,b:0},k=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),m=c&&c>=0&&1>=c?c:0,n=d&&d>=0&&1>=d?d:0,o=!1,p=0;i>p;p++){var q,r,s;if(!o){var t=new Image;t.src=a[p].image,f.drawImage(t,0,0,l.width,l.height);var u=f.getImageData(0,0,l.width,l.height);q=0,r=u.data.length,s=u.data.length/4;for(var v=0;r>v;v+=4){var w={r:u.data[v],g:u.data[v+1],b:u.data[v+2]},x=Math.sqrt(Math.pow(w.r-j.r,2)+Math.pow(w.g-j.g,2)+Math.pow(w.b-j.b,2));k*m>=x&&q++}}!o&&s*n>=s-q||(h&&(o=!0),g.push(a[p]))}return g=g.concat(a.slice(i)),g.length<=0&&g.push(a[a.length-1]),g}this.record=function(d){this.width||(this.width=320),this.height||(this.height=240),this.video&&this.video instanceof HTMLVideoElement&&(this.width||(this.width=i.videoWidth||i.clientWidth||320),this.height||(this.height=i.videoHeight||i.clientHeight||240)),this.video||(this.video={width:this.width,height:this.height}),this.canvas&&this.canvas.width&&this.canvas.height||(this.canvas={width:this.width,height:this.height}),l.width=this.canvas.width,l.height=this.canvas.height,this.video&&this.video instanceof HTMLVideoElement?(this.isHTMLObject=!0,i=this.video.cloneNode()):(i=document.createElement("video"),i.src=URL.createObjectURL(a),i.width=this.video.width,i.height=this.video.height),i.muted=!0,i.play(),j=(new Date).getTime(),k=new Whammy.Video(b.speed,b.quality),console.log("canvas resolutions",l.width,"*",l.height),console.log("video width/height",i.width||l.width,"*",i.height||l.height),c()},this.clearOldRecordedFrames=function(){k.frames=[]};var f=!1;this.requestData=function(){if(!o){if(!k.frames.length)return void(f=!1);f=!0;var a=k.frames.slice(0);k.frames=e(a,-1),k.compile(function(a){b.ondataavailable(a),console.debug("video recorded blob size:",bytesToSize(a.size))}),k.frames=[],f=!1}};var g=!1,h=!1;this.stop=function(){h=!0,this.requestData()};var i,j,k,l=document.createElement("canvas"),m=l.getContext("2d"),n=this,o=!1;this.pause=function(){o=!0},this.resume=function(){o=!1}}function GifRecorder(a){function b(){i=Date.now();var a=new Blob([new Uint8Array(k.stream().bin)],{type:"image/gif"});d.ondataavailable(a),k.stream().bin=[]}if("undefined"==typeof GIFEncoder)throw"Please link: https://cdn.webrtc-experiment.com/gif-recorder.js";this.start=function(a){function d(a){return c?void setTimeout(d,500,a):(m=requestAnimationFrame(d),void 0===typeof j&&(j=a),void(90>a-j||(g.paused&&g.play(),f.drawImage(g,0,0,i,n),k.addFrame(f),j=a)))}a=a||1e3;var i=this.videoWidth||320,n=this.videoHeight||240;e.width=g.width=i,e.height=g.height=n,k=new GIFEncoder,k.setRepeat(0),k.setDelay(this.frameRate||this.speed||200),k.setQuality(this.quality||1),k.start(),h=Date.now(),m=requestAnimationFrame(d),l=setTimeout(b,a)},this.stop=function(){m&&(cancelAnimationFrame(m),clearTimeout(l),b())};var c=!1;this.pause=function(){c=!0},this.resume=function(){c=!1},this.ondataavailable=function(){},this.onstop=function(){};var d=this,e=document.createElement("canvas"),f=e.getContext("2d"),g=document.createElement("video");g.muted=!0,g.autoplay=!0,g.src=URL.createObjectURL(a),g.play();var h,i,j,k,l,m=null}"undefined"!=typeof MediaStreamRecorder&&(MediaStreamRecorder.MultiStreamRecorder=MultiStreamRecorder);var browserFakeUserAgent="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";!function(a){"undefined"==typeof window&&("undefined"==typeof window&&"undefined"!=typeof global?(global.navigator={userAgent:browserFakeUserAgent,getUserMedia:function(){}},a.window=global):"undefined"==typeof window,"undefined"==typeof document&&(a.document={},document.createElement=document.captureStream=document.mozCaptureStream=function(){return{}}),"undefined"==typeof location&&(a.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(a.screen={width:0,height:0}))}("undefined"!=typeof global?global:window);var AudioContext=window.AudioContext;"undefined"==typeof AudioContext&&("undefined"!=typeof webkitAudioContext&&(AudioContext=webkitAudioContext),"undefined"!=typeof mozAudioContext&&(AudioContext=mozAudioContext)),"undefined"==typeof window&&(window={});var AudioContext=window.AudioContext;"undefined"==typeof AudioContext&&("undefined"!=typeof webkitAudioContext&&(AudioContext=webkitAudioContext),"undefined"!=typeof mozAudioContext&&(AudioContext=mozAudioContext));var URL=window.URL;"undefined"==typeof URL&&"undefined"!=typeof webkitURL&&(URL=webkitURL),"undefined"!=typeof navigator?("undefined"!=typeof navigator.webkitGetUserMedia&&(navigator.getUserMedia=navigator.webkitGetUserMedia),"undefined"!=typeof navigator.mozGetUserMedia&&(navigator.getUserMedia=navigator.mozGetUserMedia)):navigator={getUserMedia:function(){},userAgent:browserFakeUserAgent};var IsEdge=!(-1===navigator.userAgent.indexOf("Edge")||!navigator.msSaveBlob&&!navigator.msSaveOrOpenBlob),IsOpera=!1;"undefined"!=typeof opera&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("OPR/")&&(IsOpera=!0);var IsChrome=!IsEdge&&!IsEdge&&!!navigator.webkitGetUserMedia,MediaStream=window.MediaStream;"undefined"==typeof MediaStream&&"undefined"!=typeof webkitMediaStream&&(MediaStream=webkitMediaStream),"undefined"!=typeof MediaStream&&("getVideoTracks"in MediaStream.prototype||(MediaStream.prototype.getVideoTracks=function(){if(!this.getTracks)return[];var a=[];return this.getTracks.forEach(function(b){-1!==b.kind.toString().indexOf("video")&&a.push(b)}),a},MediaStream.prototype.getAudioTracks=function(){if(!this.getTracks)return[];var a=[];return this.getTracks.forEach(function(b){-1!==b.kind.toString().indexOf("audio")&&a.push(b)}),a}),"stop"in MediaStream.prototype||(MediaStream.prototype.stop=function(){this.getAudioTracks().forEach(function(a){a.stop&&a.stop()}),this.getVideoTracks().forEach(function(a){a.stop&&a.stop()})})),"undefined"!=typeof location&&0===location.href.indexOf("file:")&&console.error("Please load this HTML file on HTTP or HTTPS.");var ObjectStore={AudioContext:AudioContext},ObjectStore={AudioContext:window.AudioContext||window.webkitAudioContext};"undefined"!=typeof MediaStreamRecorder&&(MediaStreamRecorder.MediaRecorderWrapper=MediaRecorderWrapper),"undefined"!=typeof MediaStreamRecorder&&(MediaStreamRecorder.StereoAudioRecorder=StereoAudioRecorder),"undefined"!=typeof MediaStreamRecorder&&(MediaStreamRecorder.StereoAudioRecorderHelper=StereoAudioRecorderHelper),"undefined"!=typeof MediaStreamRecorder&&(MediaStreamRecorder.WhammyRecorder=WhammyRecorder),"undefined"!=typeof MediaStreamRecorder&&(MediaStreamRecorder.WhammyRecorderHelper=WhammyRecorderHelper),"undefined"!=typeof MediaStreamRecorder&&(MediaStreamRecorder.GifRecorder=GifRecorder);var Whammy=function(){function a(a,b){this.frames=[],a||(a=1),this.duration=1e3/a,this.quality=b||.8}function b(a){var b=URL.createObjectURL(new Blob([a.toString(),"this.onmessage =  function (e) {"+a.name+"(e.data);}"],{type:"application/javascript"})),c=new Worker(b);return URL.revokeObjectURL(b),c}function c(a){function b(a){var b=d(a);if(!b)return[];for(var e=3e4,f=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:m(b.duration),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:b.width,id:176},{data:b.height,id:186}]}]}]}]}],g=0,i=0;g<a.length;){var j=[],k=0;do j.push(a[g]),k+=a[g].duration,g++;while(g<a.length&&e>k);var l=0,n={id:524531317,data:c(i,l,j)};f[1].data.push(n),i+=k}return h(f)}function c(a,b,c){return[{data:a,id:231}].concat(c.map(function(a){var c=i({discardable:0,frame:a.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(b)});return b+=a.duration,{data:c,id:163}}))}function d(a){if(!a[0])return void postMessage({error:"Something went wrong. Maybe WebP format is not supported in the current browser."});for(var b=a[0].width,c=a[0].height,d=a[0].duration,e=1;e<a.length;e++)d+=a[e].duration;return{duration:d,width:b,height:c}}function e(a){for(var b=[];a>0;)b.push(255&a),a>>=8;return new Uint8Array(b.reverse())}function f(a){return new Uint8Array(a.split("").map(function(a){return a.charCodeAt(0)}))}function g(a){var b=[],c=a.length%8?new Array(9-a.length%8).join("0"):"";a=c+a;for(var d=0;d<a.length;d+=8)b.push(parseInt(a.substr(d,8),2));return new Uint8Array(b)}function h(a){for(var b=[],c=0;c<a.length;c++){var d=a[c].data;"object"==typeof d&&(d=h(d)),"number"==typeof d&&(d=g(d.toString(2))),"string"==typeof d&&(d=f(d));var i=d.size||d.byteLength||d.length,j=Math.ceil(Math.ceil(Math.log(i)/Math.log(2))/8),k=i.toString(2),l=new Array(7*j+7+1-k.length).join("0")+k,m=new Array(j).join("0")+"1"+l;b.push(e(a[c].id)),b.push(g(m)),b.push(d)}return new Blob(b,{type:"video/webm"})}function i(a){var b=0;if(a.keyframe&&(b|=128),a.invisible&&(b|=8),a.lacing&&(b|=a.lacing<<1),a.discardable&&(b|=1),a.trackNum>127)throw"TrackNumber > 127 not supported";var c=[128|a.trackNum,a.timecode>>8,255&a.timecode,b].map(function(a){return String.fromCharCode(a)}).join("")+a.frame;return c}function j(a){for(var b=a.RIFF[0].WEBP[0],c=b.indexOf("*"),d=0,e=[];4>d;d++)e[d]=b.charCodeAt(c+3+d);var f,g,h;return h=e[1]<<8|e[0],f=16383&h,h=e[3]<<8|e[2],g=16383&h,{width:f,height:g,data:b,riff:a}}function k(a,b){return parseInt(a.substr(b+4,4).split("").map(function(a){var b=a.charCodeAt(0).toString(2);return new Array(8-b.length+1).join("0")+b}).join(""),2)}function l(a){for(var b=0,c={};b<a.length;){var d=a.substr(b,4),e=k(a,b),f=a.substr(b+4+4,e);b+=8+e,c[d]=c[d]||[],"RIFF"===d||"LIST"===d?c[d].push(l(f)):c[d].push(f)}return c}function m(a){return[].slice.call(new Uint8Array(new Float64Array([a]).buffer),0).map(function(a){return String.fromCharCode(a)}).reverse().join("")}var n=new b(a.map(function(a){var b=j(l(atob(a.image.slice(23))));return b.duration=a.duration,b}));postMessage(n)}return a.prototype.add=function(a,b){if("canvas"in a&&(a=a.canvas),"toDataURL"in a&&(a=a.toDataURL("image/webp",this.quality)),!/^data:image\/webp;base64,/gi.test(a))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:a,duration:b||this.duration})},a.prototype.compile=function(a){var d=b(c);d.onmessage=function(b){return b.data.error?void console.error(b.data.error):void a(b.data)},d.postMessage(this.frames)},{Video:a}}();"undefined"!=typeof MediaStreamRecorder&&(MediaStreamRecorder.Whammy=Whammy),function(){window.ConcatenateBlobs=function(a,b,c){function d(){if(!a[g])return e();var b=new FileReader;b.onload=function(a){f.push(a.target.result),g++,d()},b.readAsArrayBuffer(a[g])}function e(){var a=0;f.forEach(function(b){a+=b.byteLength});var d=new Uint16Array(a),e=0;f.forEach(function(a){var b=a.byteLength;b%2!=0&&(a=a.slice(0,b-1)),d.set(new Uint16Array(a),e),e+=b});var g=new Blob([d.buffer],{type:b});c(g)}var f=[],g=0;d()}}(),"undefined"!=typeof module&&(module.exports=MediaStreamRecorder),"function"==typeof define&&define.amd&&define("MediaStreamRecorder",[],function(){return MediaStreamRecorder});