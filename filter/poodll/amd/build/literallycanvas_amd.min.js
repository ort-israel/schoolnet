define(["jquery","core/log","filter_poodll/utils_amd","filter_poodll/uploader","filter_poodll/react_amd","filter_poodll/literallycanvas"],function(a,b,c,d,e,f){"use strict";return b.debug("Filter PoodLL: literallycanvas.js initialising"),{loadliterallycanvas:function(b){var c="#amdopts_"+b.recorderid,e=a(c).get(0);e&&(b=JSON.parse(e.value),this.config=b,a(c).remove());var g="#"+b.recorderid+"_literally",h=a(g)[0];if(b.backgroundimage){var i=a("#"+b.recorderid+"_separate-background-image")[0],j=new Image;j.src=i.src,j.crossOrigin="Anonymous";var k=f.createShape("Image",{x:0,y:0,image:j,scale:1}),l=f.init(h,{imageURLPrefix:b.imageurlprefix,backgroundColor:b.backgroundcolor,backgroundShapes:[k],recorderid:b.recorderid})}else var l=f.init(h,{imageURLPrefix:b.imageurlprefix,backgroundColor:b.backgroundcolor,recorderid:b.recorderid});this.lc=l,d.init(g,b);var m=b.vectordata;m&&(0==m.indexOf('{"shapes"')||0==m.indexOf('{"colors"'))&&l.loadSnapshot(JSON.parse(m)),this.registerEvents()},registerEvents:function(){var b=this,e=this.config,f=e.recorderid;e.autosave?this.lc.on("drawingChange",function(){var d=a("#"+f+"_messages")[0],g=a("#"+f+"_btn_upload_whiteboard")[0];if(d){g&&(g.disabled=!1),d.innerHTML="";var h=c.timeouthandles[f];h&&clearTimeout(h),c.timeouthandles[f]=setTimeout(function(){c.WhiteboardUploadHandler(f,b.lc,e)},e.autosave)}}):lc.on("drawingChange",function(){var b=a("#"+f+"_messages");b&&(b.innerHTML="File has not been saved.")});var g="#"+e.recorderid+"_btn_upload_whiteboard",h=a(g);if(h)if(e.autosave)h.click(function(){c.WhiteboardUploadHandler(e.recorderid,b.lc)},!1);else{var i=c.getCvs(e.recorderid,b.lc,e);h.click(function(){c.pokeVectorData(e.recorderid,b.lc,e),d.uploadFile(i.toDataURL(),"image")},!1)}}}});