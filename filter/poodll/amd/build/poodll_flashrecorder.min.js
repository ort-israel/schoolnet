define(["jquery","core/log","filter_poodll/uploader","filter_poodll/lzflash"],function(a,b,c,d){"use strict";return b.debug("PoodLL Flash Recorder: initialising"),{savebutton:null,audiodatacontrol:null,supports_current_browser:function(a){var c=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;return c?!1:"video"==a.mediatype?!1:(b.debug("PoodLL Flash Recorder: supports this browser"),!0)},embed:function(b,e){var f=a.parseJSON(e.flashmp3audio_widgetjson);d.embed.swf(f);var g=e.widgetid+"_savebutton",h='<button id="'+g+'" class="poodll_save-recording">'+M.util.get_string("recui_save","filter_poodll")+"</button>";a(b).append(h);var i=e.widgetid+"_audiodatacontrol",j='<input type="hidden" id="'+i+'"/>';a(b).prepend(j),c.init(b,e),d.embed[e.widgetid].setCanvasAttribute("audiodatacontrol",i),this.savebutton=a("#"+g),this.audiodatacontrol=a("#"+i),this.registerevents()},registerevents:function(){var a=this;this.savebutton.click(function(){for(var b=atob(a.audiodatacontrol.val()),d=[],e=0;e<b.length;e++)d.push(b.charCodeAt(e));var f=new Blob([new Uint8Array(d)],{type:"audio/mpeg3"});c.uploadBlob(f,"audio/mpeg3")})}}});