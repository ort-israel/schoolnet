YUI.add("moodle-atto_poodll-button",function(e,t){var n="atto_poodll",r="poodllfilename",i="atto_poodll",s={INPUTSUBMIT:"atto_media_urlentrysubmit",INPUTCANCEL:"atto_media_urlentrycancel"},o='<form class="atto_form"><div id="{{elementid}}_{{innerform}}" class="mdl-align"><input id="{{elementid}}_{{poodllfilename}}" type="hidden" name="{{elementid}}_{{poodllfilename}}" /><button class="{{CSS.INPUTSUBMIT}}">{{get_string "insert" component}}</button></div></form>',u='<img src="{{url}}" alt="{{alt}}"/>';e.namespace("M.atto_poodll").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{_currentSelection:null,_content:null,_currentrecorder:null,_itemid:null,_usercontextid:null,_usewhiteboard:null,initializer:function(e){this._usercontextid=e.usercontextid,this._usewhiteboard=e.usewhiteboard;var t=this.get("host"),n=t.get("filepickeroptions");if(!n.image||!n.image.itemid)return;this._itemid=n.image.itemid;if(e.disabled)return;var r=new Array("audiomp3","audiored5","video","whiteboard","snapshot");for(var i=0;i<r.length;i++)e.hasOwnProperty(r[i])&&this.addButton({icon:r[i],iconComponent:"atto_poodll",title:r[i]+"_desc",buttonName:r[i],callback:this._displayDialogue,callbackArgs:r[i]})},_displayDialogue:function(t,r){t.preventDefault(),this._currentrecorder=r;var i=400,s=260;switch(r){case"audiomp3":case"audiored5":i=400,s=260;break;case"video":case"snapshot":i=400,s=450;break;case"whiteboard":i=680,s=540}var o=this.getDialogue({headerContent:M.util.get_string("dialogtitle",n),width:i+"px",focusAfterHide:r});o.width!=i+"px"&&o.set("width",i+"px");var u=e.Node.create("<iframe></iframe>");u.setStyles({height:s+"px",border:"none",width:"100%",overflow:"hidden"}),u.setAttribute("src",this._getIframeURL(r)),u.setAttribute("scrolling","no");var a=this._getFormContent(),f=e.Node.create("<div></div>");f.append(u).append(a),o.set("bodyContent",f),o.show(),this.markUpdated()},_getIframeURL:function(e){return M.cfg.wwwroot+"/lib/editor/atto/plugins/poodll/dialog/poodll.php?"+"itemid="+this._itemid+"&recorder="+e+"&usewhiteboard="+this._usewhiteboard+"&updatecontrol="+this._getFilenameControlName()},_getFormContent:function(){var t=e.Handlebars.compile(o),i=e.Node.create(t({elementid:this.get("host").get("elementid"),CSS:s,poodllfilename:r,component:n}));return this._form=i,this._form.one("."+s.INPUTSUBMIT).on("click",this._doInsert,this),i},_getFilenameControlName:function(){return this.get("host").get("elementid")+"_"+r},_doInsert:function(t){t.preventDefault(),this.getDialogue({focusAfterHide:null}).hide();var n=document.getElementById(this._getFilenameControlName());if(!n.value)return;var n=n.value,r=M.cfg.wwwroot,i="",s=r+"/draftfile.php/"+this._usercontextid+"/user/draft/"+this._itemid+"/"+n;this._currentrecorder==="snapshot"||this._currentrecorder==="whiteboard"?(template=e.Handlebars.compile(u),i=template({url:s,alt:n})):i='<a href="'+s+'">'+n+"</a>",this.editor.focus(),this.get("host").insertContentAtFocusPoint(i),this.markUpdated()},updatefilename:function(e){var t=document.getElementById(this._getFilenameControlName());t===null&&(t=parent.document.getElementById(e[3])),t&&(t.value=e[2],this._form.one("."+s.INPUTSUBMIT).disabled=!1)}},{usercontextid:{value:null},usewhiteboard:{value:"drawingboard"}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});
